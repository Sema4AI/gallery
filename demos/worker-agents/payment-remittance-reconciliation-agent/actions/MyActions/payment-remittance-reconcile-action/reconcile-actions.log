2024-11-04 11:37:32 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 03:28:56 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 03:43:14 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 03:43:24 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 03:43:25 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:10:16 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:10:23 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:10:35 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:11:48 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:11:48 - reconcile_actions - INFO - Starting remittance work item retrieval for ID: 28b645bd117f3236f3aa8e882847b634
2024-11-05 04:11:48 - root - INFO - Documents Data Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/documents
2024-11-05 04:11:48 - root - INFO - Work Items Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/events
2024-11-05 04:11:49 - root - DEBUG - Received data for document_id 28b645bd117f3236f3aa8e882847b634: source_document=SourceDocument(document_id='28b645bd117f3236f3aa8e882847b634', document_name='ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_src_path='s3://ace-2ba8afa9-5fcb-42ab-b1c3-e1c2f36fef6e-di-data/in/d5508320-a7fe-4987-bd26-d066b75558d2/Payment Remittance Reconciliation for Customer Transactions V6/Wire Transfer/ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_type=DocType(name='Payment Remittance Reconciliation for Customer Transactions V6', file_format='PDF', source_location='', description='', validation_expressions=[], non_tbl_fields=[DocumentTypeConfigurationNonTblFieldsInner(name='Customer Name', requirement='Required', id='temp-1730628635138'), DocumentTypeConfigurationNonTblFieldsInner(name='Customer ID', requirement='Required', id='temp-1730628644206'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Date', requirement='Required', id='temp-1730628648089'), DocumentTypeConfigurationNonTblFieldsInner(name='Bank Account Number', requirement='Required', id='temp-1730628653440'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Payment Paid', requirement='Required', id='temp-1730628658440'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Reference Number', requirement='Required', id='temp-1730628663272'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Method', requirement='Required', id='temp-1730628668074'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoice Amount', requirement='Required', id='temp-1730628673974'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Additional Charges', requirement='Optional', id='temp-1730628685222'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Discounts Applied', requirement='Optional', id='temp-1730628687623'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoices', requirement='Required', id='temp-1730628692605'), DocumentTypeConfigurationNonTblFieldsInner(name='Remittance Notes', requirement='Optional', id='temp-1730628699725')], tbl_fields=[DocTypeTblFieldsInner(name='Invoice Details', description='This table contains detailed line-item information for invoices associated with customer payments. It includes critical fields such as invoice number, date, amount due, and payment sent. This table supports AquaEnergy Solutions by capturing utility data such as electricity and water usage.', id='temp-1730628775141', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628812191', column='Invoice Number', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628817739', column='Invoice Date', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628824305', column='Invoice Amount', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628826056', column='Additional Charges', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628830090', column='Discounts Applied', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628834323', column='Amount Paid', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628840606', column='Facility ID', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628917574', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628923123', column='Service Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628927639', column='Usage', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628934757', column='Rate Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628936305', column='CO2 Supplementation', type='', requirement='Optional')]), DocTypeTblFieldsInner(name='Facility Type Subtotals', description='Provides a summary of invoice amounts grouped by facility type.', id='temp-1730629018789', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629029105', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629035373', column='Subtotal Invoice Amount', type='', requirement='Required')])], config=['camelot_flavor'], created_timestamp=datetime.datetime(2024, 11, 3, 10, 10, 31, tzinfo=TzInfo(UTC)), updated_timestamp=datetime.datetime(2024, 11, 3, 10, 23, 2, tzinfo=TzInfo(UTC)), processing_workflow=[DocumentProcessingWorkflow(id='885a014d-df4f-4432-8400-f5d6d0549c2e', name='WorkItem', index='1', description='Document Intelligence: Main Processing Stage')]), document_format=DocumentFormat(document_type_name='Payment Remittance Reconciliation for Customer Transactions V6', document_class_name='Wire Transfer', non_tbl_fields_mapping=[DocumentFormatNonTblFieldsMappingInner(field_name='Customer Name', field_identifier='Payer Name', static_value='', id='801980a5-0d34-4d5a-84cb-08e90ee078e3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Customer ID', field_identifier='Client ID', static_value='', id='32f0fa36-cd60-4e06-8ffc-85cd856e20b7', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Date', field_identifier='Wire Transfer Date', static_value='', id='796df829-55b2-45e3-9a14-81e37f9d7cae', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Bank Account Number', field_identifier='Beneficiary Account Number', static_value='', id='7178b499-ce98-41d5-a85a-4e65d0c64f51', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Payment Paid', field_identifier='Total Wire Amount', static_value='', id='a412419d-15a6-41aa-853e-858fae65ff13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Reference Number', field_identifier='Wire Transfer Reference', static_value='', id='d506aa75-ebd4-4510-9c65-d3533f04a418', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Method', field_identifier='Payment Type', static_value='', id='384b0a16-de0b-48e8-83e3-8b401b9657f5', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoice Amount', field_identifier='Total Amount Due', static_value='', id='1cebbd10-10f0-479b-b083-d64b421df84d', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Additional Charges', field_identifier='Total Fees', static_value='', id='d457bb56-1225-488f-842e-50b925e557a3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Discounts Applied', field_identifier='Total Discounts', static_value='', id='ece4bf02-d39b-4262-b7d5-c93974d3fc13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoices', field_identifier='Total Invoices', static_value='', id='21ba1951-9598-4a74-a24b-be2f41a96849', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Remittance Notes', field_identifier='Additional Payment Notes', static_value='', id='5240008f-adb2-4f40-a144-9505fed93193', additional_prompt_instructions='')], tables=[DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Number', output='Invoice Reference', id='cc38acdf-1d17-4c57-aa41-c049286efbff'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Date', output='Date of Invoice', id='8f6a251e-0700-443e-8e20-6ddcfaa6df50'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Amount', output='Amount Due', id='cff5c50b-a045-44be-bfb8-9670eedd8ed1'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Additional Charges', output='Fees', id='71688ea6-5c14-4e66-b45c-ebdb849eb569'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Discounts Applied', output='Discounts', id='3d5cd913-6645-4896-ae0f-c495d4f8271c'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Amount Paid', output='Payment Sent', id='27c8f9ad-203c-4e55-9d69-cf2d5419d491'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility ID', output='Facility ID', id='a36554f8-8bfc-41c6-b849-6af06ac45cf8'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='ad68bd93-65a5-4d5e-ae45-da1dd2e12a59'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Service Type', output='Service Type', id='b7de4abc-07cc-4723-91f2-e647c742b6fa'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Usage', output='Usage (kWh/Gallons)', id='3e14afdf-265d-4755-b75b-6f8417188240'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Rate Type', output='', id='4b1bb0c1-4d5e-4575-8378-2feabf22c972'), DocumentFormatTablesInnerTblFieldsMappingInner(source='CO2 Supplementation', output='CO2 Supplementation (kg)', id='d48fb263-a30c-4e74-84f4-049011216422')]), DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='35553893-d3f3-4aad-8e01-3b8901795ce2'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Subtotal Invoice Amount', output='', id='f40587e8-9675-44ec-9fa3-f9265f4d260c')])], prompt_examples='Here are table row examples for Table 1 (Invoice Details), handling different Facility ID labels and includes the derived Facility Type column.\n```markdown\n    \n<!--SOT-->\n| Invoice Reference | Amount Due | Payment Sent | Discounts | Fees | Date of Invoice | Facility ID | Facility Type          | Service Type | Usage (kWh/Gallons) | CO2 Supplementation (kg) |\n|-------------------|------------|--------------|-----------|------|-----------------|-------------|------------------------|--------------|---------------------|-------------------------|\n| INV-GH-005001     | $87,654.22 | $86,777.78   | $876.54   | $0.00| 09/01/2024      | EGA-GH-001  | Greenhouse Complexes   | Electricity  | 730,453 kWh         | 3,652                   |\n| INV-GH-005002     | $45,678.90 | $45,222.11   | $456.79   | $0.00| 09/03/2024      | EGA-GH-001  | Greenhouse Complexes   | Water        | 380,658 Gallons     | N/A                     |\n| INV-GH-005003     | $92,345.67 | $91,422.21   | $923.46   | $0.00| 09/05/2024      | EGA-GH-002  | Greenhouse Complexes   | Electricity  | 769,547 kWh         | 3,848                   |\n| INV-GH-005004     | $56,789.01 | $56,221.12   | $567.89   | $0.00| 09/07/2024      | EGA-GH-002  | Greenhouse Complexes   | Water        | 473,242 Gallons     | N/A                     |\n| INV-GH-005005     | $78,901.23 | $78,112.22   | $789.01   | $0.00| 09/09/2024      | EGA-GH-003  | Greenhouse Complexes   | Electricity  | 657,510 kWh         | 3,288                   |\n| INV-GH-005006     | $34,567.89 | $34,222.21   | $345.68   | $0.00| 09/11/2024      | EGA-GH-003  | Greenhouse Complexes   | Water        | 288,066 Gallons     | N/A                     |\n| INV-GH-005007     | $95,678.90 | $94,722.11   | $956.79   | $0.00| 09/13/2024      | EGA-GH-004  | Greenhouse Complexes   | Electricity  | 797,324 kWh         | 3,987                   |\n| INV-GH-005008     | $67,890.12 | $67,211.22   | $678.90   | $0.00| 09/15/2024      | EGA-GH-004  | Greenhouse Complexes   | Water        | 565,751 Gallons     | N/A                     |\n| INV-GH-005009     | $82,345.67 | $81,522.21   | $823.46   | $0.00| 09/17/2024      | EGA-GH-005  | Greenhouse Complexes   | Electricity  | 686,214 kWh         | 3,431                   |\n| INV-GH-005010     | $43,210.98 | $42,778.87   | $432.11   | $0.00| 09/19/2024      | EGA-GH-005  | Greenhouse Complexes   | Water        | 360,091 Gallons     | N/A                     |\n| INV-GH-005011     | $89,012.34 | $88,122.22   | $890.12   | $0.00| 09/21/2024      | EGA-GH-006  | Greenhouse Complexes   | Electricity  | 741,769 kWh         | 3,709                   |\n| INV-GH-005012     | $54,321.09 | $53,777.78   | $543.21   | $0.00| 09/23/2024      | EGA-GH-006  | Greenhouse Complexes   | Water        | 452,676 Gallons     | N/A                     |\n<!--EOT-->\n```\n\nHere are table row examples for Table 2 (Facility Type Subtotals). It is a derived table for each Facility Type subtotal . Each of these tables should have exactly 1 row. \n```markdown\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------------|-------------------------|\n| Greenhouse Complexes        | $820,112.06             |\n<!--EOT-->\n\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------x------|-------------------------|\n| Vertical Farming Units      | $805,831.96             |\n<!--EOT-->\n```', prompt_instructions='Please extract two sets of tables from the document, using the following rules:\n\n### For **Table 1 (Invoice Details):**\n* This table captures detailed invoice-level information for customer payments made to Acqia Energy Solutions. It includes columns:\n  * `Invoice Reference`, `Amount Due`, `Payment Sent`, `Discounts`, `Fees`, `Date of Invoice`, `Facility ID`, `Facility Type`, `Service Type`, `Usage (kWh/Gallons)`, `CO2 Supplementation (kg)`.\n* The column **Facility ID** may be labeled differently across tables. It can appear as **Unit ID**, **System ID**, or simply **Facility**. Treat all these labels as the same column, and extract the relevant ID for each row.\n* **Facility Type** is a derived column that should be added to the extracted table. Populate this column with the Facility Type name based on each section’s subheader (e.g., "Greenhouse Complexes" or "Vertical Farming Units") and ensure every row in the section has the same Facility Type value.\n* Ensure that all other data is extracted based on the columns specified, including `Service Type`, `Usage`, and `CO2 Supplementation`.\n\n### For **Table 2 (Facility Type Subtotals):**\n* This table captures summary information of total invoice amounts grouped by Facility Type. It includes:\n  * `Facility Type`, found in the section header, and `Subtotal Invoice Amount`, found in the bottom line of each table.\n* For example, \'Subtotal for Greenhouse Complexes: $820,112.06\' can be found at the bottom of each table. Extract "Greenhouse Complexes" as the Facility Type and `$820,112.06` as the `Subtotal Invoice Amount`.. ', custom_config={'camelot_flavor': 'lattice'}, state=None), doc_size=39271, pages=4, created_date=datetime.datetime(2024, 11, 5, 3, 55, 10, tzinfo=TzInfo(UTC)), content_type='Wire Transfer') current_content=<ContentState.COMPUTED: 'Computed'> processing_status=<ProcessingStatus.VALIDATION_COMPLETED: 'Validation Completed'> retry_count=3 last_run=datetime.datetime(2024, 11, 5, 5, 9, 31, tzinfo=TzInfo(UTC)) workspace_id='d5508320-a7fe-4987-bd26-d066b75558d2' non_tbl_data={'Customer ID': 'ZGS-928374', 'Payment Date': '2024-11-15', 'Customer Name': 'ZonalGreen Systems', 'Payment Method': 'Wire Transfer', 'Total Invoices': '60', 'Remittance Notes': 'Q4 2024 Utilities for Hydroponic Facilities', 'Total Payment Paid': '$3,715,905.55', 'Bank Account Number': '*****33981', 'Total Invoice Amount': '$3,774,599.76', 'Total Discounts Applied': '$37,534.41', 'Payment Reference Number': 'WIRE847362920183', 'Total Additional Charges': '$0.00'}
2024-11-05 04:11:49 - ReconciliationAgentContextManager - INFO - Starting database initialization
2024-11-05 04:11:49 - ReconciliationAgentContextManager - INFO - Reconciliation tables created successfully
2024-11-05 04:11:49 - ReconciliationAgentContextManager - INFO - Database initialization completed successfully
2024-11-05 04:11:49 - ReconciliationAgentContextManager - DEBUG - Database connection closed successfully.
2024-11-05 04:11:49 - ReconciliationAgentContextManager - DEBUG - Database connection closed successfully.
2024-11-05 04:11:49 - ReconciliationAgentContextManager - INFO - Stored reconciliation context for document_id: 28b645bd117f3236f3aa8e882847b634
2024-11-05 04:11:49 - reconcile_actions - INFO - Returning response: ActionResponse(status=success, message='Work item retrieved and validated successfully')
2024-11-05 04:11:55 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:11:55 - reconcile_actions - INFO - Starting combined payment storage and analysis for remittance ID: 28b645bd117f3236f3aa8e882847b634
2024-11-05 04:11:55 - root - INFO - Documents Data Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/documents
2024-11-05 04:11:55 - root - INFO - Work Items Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/events
2024-11-05 04:11:56 - root - DEBUG - Received data for document_id 28b645bd117f3236f3aa8e882847b634: source_document=SourceDocument(document_id='28b645bd117f3236f3aa8e882847b634', document_name='ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_src_path='s3://ace-2ba8afa9-5fcb-42ab-b1c3-e1c2f36fef6e-di-data/in/d5508320-a7fe-4987-bd26-d066b75558d2/Payment Remittance Reconciliation for Customer Transactions V6/Wire Transfer/ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_type=DocType(name='Payment Remittance Reconciliation for Customer Transactions V6', file_format='PDF', source_location='', description='', validation_expressions=[], non_tbl_fields=[DocumentTypeConfigurationNonTblFieldsInner(name='Customer Name', requirement='Required', id='temp-1730628635138'), DocumentTypeConfigurationNonTblFieldsInner(name='Customer ID', requirement='Required', id='temp-1730628644206'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Date', requirement='Required', id='temp-1730628648089'), DocumentTypeConfigurationNonTblFieldsInner(name='Bank Account Number', requirement='Required', id='temp-1730628653440'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Payment Paid', requirement='Required', id='temp-1730628658440'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Reference Number', requirement='Required', id='temp-1730628663272'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Method', requirement='Required', id='temp-1730628668074'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoice Amount', requirement='Required', id='temp-1730628673974'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Additional Charges', requirement='Optional', id='temp-1730628685222'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Discounts Applied', requirement='Optional', id='temp-1730628687623'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoices', requirement='Required', id='temp-1730628692605'), DocumentTypeConfigurationNonTblFieldsInner(name='Remittance Notes', requirement='Optional', id='temp-1730628699725')], tbl_fields=[DocTypeTblFieldsInner(name='Invoice Details', description='This table contains detailed line-item information for invoices associated with customer payments. It includes critical fields such as invoice number, date, amount due, and payment sent. This table supports AquaEnergy Solutions by capturing utility data such as electricity and water usage.', id='temp-1730628775141', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628812191', column='Invoice Number', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628817739', column='Invoice Date', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628824305', column='Invoice Amount', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628826056', column='Additional Charges', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628830090', column='Discounts Applied', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628834323', column='Amount Paid', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628840606', column='Facility ID', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628917574', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628923123', column='Service Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628927639', column='Usage', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628934757', column='Rate Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628936305', column='CO2 Supplementation', type='', requirement='Optional')]), DocTypeTblFieldsInner(name='Facility Type Subtotals', description='Provides a summary of invoice amounts grouped by facility type.', id='temp-1730629018789', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629029105', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629035373', column='Subtotal Invoice Amount', type='', requirement='Required')])], config=['camelot_flavor'], created_timestamp=datetime.datetime(2024, 11, 3, 10, 10, 31, tzinfo=TzInfo(UTC)), updated_timestamp=datetime.datetime(2024, 11, 3, 10, 23, 2, tzinfo=TzInfo(UTC)), processing_workflow=[DocumentProcessingWorkflow(id='885a014d-df4f-4432-8400-f5d6d0549c2e', name='WorkItem', index='1', description='Document Intelligence: Main Processing Stage')]), document_format=DocumentFormat(document_type_name='Payment Remittance Reconciliation for Customer Transactions V6', document_class_name='Wire Transfer', non_tbl_fields_mapping=[DocumentFormatNonTblFieldsMappingInner(field_name='Customer Name', field_identifier='Payer Name', static_value='', id='801980a5-0d34-4d5a-84cb-08e90ee078e3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Customer ID', field_identifier='Client ID', static_value='', id='32f0fa36-cd60-4e06-8ffc-85cd856e20b7', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Date', field_identifier='Wire Transfer Date', static_value='', id='796df829-55b2-45e3-9a14-81e37f9d7cae', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Bank Account Number', field_identifier='Beneficiary Account Number', static_value='', id='7178b499-ce98-41d5-a85a-4e65d0c64f51', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Payment Paid', field_identifier='Total Wire Amount', static_value='', id='a412419d-15a6-41aa-853e-858fae65ff13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Reference Number', field_identifier='Wire Transfer Reference', static_value='', id='d506aa75-ebd4-4510-9c65-d3533f04a418', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Method', field_identifier='Payment Type', static_value='', id='384b0a16-de0b-48e8-83e3-8b401b9657f5', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoice Amount', field_identifier='Total Amount Due', static_value='', id='1cebbd10-10f0-479b-b083-d64b421df84d', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Additional Charges', field_identifier='Total Fees', static_value='', id='d457bb56-1225-488f-842e-50b925e557a3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Discounts Applied', field_identifier='Total Discounts', static_value='', id='ece4bf02-d39b-4262-b7d5-c93974d3fc13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoices', field_identifier='Total Invoices', static_value='', id='21ba1951-9598-4a74-a24b-be2f41a96849', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Remittance Notes', field_identifier='Additional Payment Notes', static_value='', id='5240008f-adb2-4f40-a144-9505fed93193', additional_prompt_instructions='')], tables=[DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Number', output='Invoice Reference', id='cc38acdf-1d17-4c57-aa41-c049286efbff'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Date', output='Date of Invoice', id='8f6a251e-0700-443e-8e20-6ddcfaa6df50'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Amount', output='Amount Due', id='cff5c50b-a045-44be-bfb8-9670eedd8ed1'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Additional Charges', output='Fees', id='71688ea6-5c14-4e66-b45c-ebdb849eb569'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Discounts Applied', output='Discounts', id='3d5cd913-6645-4896-ae0f-c495d4f8271c'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Amount Paid', output='Payment Sent', id='27c8f9ad-203c-4e55-9d69-cf2d5419d491'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility ID', output='Facility ID', id='a36554f8-8bfc-41c6-b849-6af06ac45cf8'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='ad68bd93-65a5-4d5e-ae45-da1dd2e12a59'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Service Type', output='Service Type', id='b7de4abc-07cc-4723-91f2-e647c742b6fa'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Usage', output='Usage (kWh/Gallons)', id='3e14afdf-265d-4755-b75b-6f8417188240'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Rate Type', output='', id='4b1bb0c1-4d5e-4575-8378-2feabf22c972'), DocumentFormatTablesInnerTblFieldsMappingInner(source='CO2 Supplementation', output='CO2 Supplementation (kg)', id='d48fb263-a30c-4e74-84f4-049011216422')]), DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='35553893-d3f3-4aad-8e01-3b8901795ce2'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Subtotal Invoice Amount', output='', id='f40587e8-9675-44ec-9fa3-f9265f4d260c')])], prompt_examples='Here are table row examples for Table 1 (Invoice Details), handling different Facility ID labels and includes the derived Facility Type column.\n```markdown\n    \n<!--SOT-->\n| Invoice Reference | Amount Due | Payment Sent | Discounts | Fees | Date of Invoice | Facility ID | Facility Type          | Service Type | Usage (kWh/Gallons) | CO2 Supplementation (kg) |\n|-------------------|------------|--------------|-----------|------|-----------------|-------------|------------------------|--------------|---------------------|-------------------------|\n| INV-GH-005001     | $87,654.22 | $86,777.78   | $876.54   | $0.00| 09/01/2024      | EGA-GH-001  | Greenhouse Complexes   | Electricity  | 730,453 kWh         | 3,652                   |\n| INV-GH-005002     | $45,678.90 | $45,222.11   | $456.79   | $0.00| 09/03/2024      | EGA-GH-001  | Greenhouse Complexes   | Water        | 380,658 Gallons     | N/A                     |\n| INV-GH-005003     | $92,345.67 | $91,422.21   | $923.46   | $0.00| 09/05/2024      | EGA-GH-002  | Greenhouse Complexes   | Electricity  | 769,547 kWh         | 3,848                   |\n| INV-GH-005004     | $56,789.01 | $56,221.12   | $567.89   | $0.00| 09/07/2024      | EGA-GH-002  | Greenhouse Complexes   | Water        | 473,242 Gallons     | N/A                     |\n| INV-GH-005005     | $78,901.23 | $78,112.22   | $789.01   | $0.00| 09/09/2024      | EGA-GH-003  | Greenhouse Complexes   | Electricity  | 657,510 kWh         | 3,288                   |\n| INV-GH-005006     | $34,567.89 | $34,222.21   | $345.68   | $0.00| 09/11/2024      | EGA-GH-003  | Greenhouse Complexes   | Water        | 288,066 Gallons     | N/A                     |\n| INV-GH-005007     | $95,678.90 | $94,722.11   | $956.79   | $0.00| 09/13/2024      | EGA-GH-004  | Greenhouse Complexes   | Electricity  | 797,324 kWh         | 3,987                   |\n| INV-GH-005008     | $67,890.12 | $67,211.22   | $678.90   | $0.00| 09/15/2024      | EGA-GH-004  | Greenhouse Complexes   | Water        | 565,751 Gallons     | N/A                     |\n| INV-GH-005009     | $82,345.67 | $81,522.21   | $823.46   | $0.00| 09/17/2024      | EGA-GH-005  | Greenhouse Complexes   | Electricity  | 686,214 kWh         | 3,431                   |\n| INV-GH-005010     | $43,210.98 | $42,778.87   | $432.11   | $0.00| 09/19/2024      | EGA-GH-005  | Greenhouse Complexes   | Water        | 360,091 Gallons     | N/A                     |\n| INV-GH-005011     | $89,012.34 | $88,122.22   | $890.12   | $0.00| 09/21/2024      | EGA-GH-006  | Greenhouse Complexes   | Electricity  | 741,769 kWh         | 3,709                   |\n| INV-GH-005012     | $54,321.09 | $53,777.78   | $543.21   | $0.00| 09/23/2024      | EGA-GH-006  | Greenhouse Complexes   | Water        | 452,676 Gallons     | N/A                     |\n<!--EOT-->\n```\n\nHere are table row examples for Table 2 (Facility Type Subtotals). It is a derived table for each Facility Type subtotal . Each of these tables should have exactly 1 row. \n```markdown\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------------|-------------------------|\n| Greenhouse Complexes        | $820,112.06             |\n<!--EOT-->\n\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------x------|-------------------------|\n| Vertical Farming Units      | $805,831.96             |\n<!--EOT-->\n```', prompt_instructions='Please extract two sets of tables from the document, using the following rules:\n\n### For **Table 1 (Invoice Details):**\n* This table captures detailed invoice-level information for customer payments made to Acqia Energy Solutions. It includes columns:\n  * `Invoice Reference`, `Amount Due`, `Payment Sent`, `Discounts`, `Fees`, `Date of Invoice`, `Facility ID`, `Facility Type`, `Service Type`, `Usage (kWh/Gallons)`, `CO2 Supplementation (kg)`.\n* The column **Facility ID** may be labeled differently across tables. It can appear as **Unit ID**, **System ID**, or simply **Facility**. Treat all these labels as the same column, and extract the relevant ID for each row.\n* **Facility Type** is a derived column that should be added to the extracted table. Populate this column with the Facility Type name based on each section’s subheader (e.g., "Greenhouse Complexes" or "Vertical Farming Units") and ensure every row in the section has the same Facility Type value.\n* Ensure that all other data is extracted based on the columns specified, including `Service Type`, `Usage`, and `CO2 Supplementation`.\n\n### For **Table 2 (Facility Type Subtotals):**\n* This table captures summary information of total invoice amounts grouped by Facility Type. It includes:\n  * `Facility Type`, found in the section header, and `Subtotal Invoice Amount`, found in the bottom line of each table.\n* For example, \'Subtotal for Greenhouse Complexes: $820,112.06\' can be found at the bottom of each table. Extract "Greenhouse Complexes" as the Facility Type and `$820,112.06` as the `Subtotal Invoice Amount`.. ', custom_config={'camelot_flavor': 'lattice'}, state=None), doc_size=39271, pages=4, created_date=datetime.datetime(2024, 11, 5, 3, 55, 10, tzinfo=TzInfo(UTC)), content_type='Wire Transfer') current_content=<ContentState.COMPUTED: 'Computed'> processing_status=<ProcessingStatus.VALIDATION_COMPLETED: 'Validation Completed'> retry_count=3 last_run=datetime.datetime(2024, 11, 5, 5, 9, 31, tzinfo=TzInfo(UTC)) workspace_id='d5508320-a7fe-4987-bd26-d066b75558d2' non_tbl_data={'Customer ID': 'ZGS-928374', 'Payment Date': '2024-11-15', 'Customer Name': 'ZonalGreen Systems', 'Payment Method': 'Wire Transfer', 'Total Invoices': '60', 'Remittance Notes': 'Q4 2024 Utilities for Hydroponic Facilities', 'Total Payment Paid': '$3,715,905.55', 'Bank Account Number': '*****33981', 'Total Invoice Amount': '$3,774,599.76', 'Total Discounts Applied': '$37,534.41', 'Payment Reference Number': 'WIRE847362920183', 'Total Additional Charges': '$0.00'}
2024-11-05 04:11:56 - ReconciliationAgentContextManager - INFO - Starting database initialization
2024-11-05 04:11:56 - ReconciliationAgentContextManager - INFO - Reconciliation tables created successfully
2024-11-05 04:11:56 - ReconciliationAgentContextManager - INFO - Database initialization completed successfully
2024-11-05 04:11:56 - ReconciliationAgentContextManager - DEBUG - Database connection closed successfully.
2024-11-05 04:11:56 - ReconciliationAgentContextManager - INFO - Started reconciliation phase: Payment Data Loading
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Initializing InvoiceLoader
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Database path set to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.services.invoice_reconciliation_service - INFO - Storing payment for customer ZGS-928374
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Establishing database connection to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection established successfully
2024-11-05 04:11:56 - reconciliation_ledger.services.invoice_reconciliation_service - INFO - Stored payment PMT-2024-11-15-WIRE847362920183 with 60 allocations:
Total Payment: $3,715,905.55
Total Allocated: $3,715,905.55
Total Invoices: 60
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection closed successfully
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Initializing InvoiceLoader
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - INFO - Database path set to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Establishing database connection to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection established successfully
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection closed successfully
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Establishing database connection to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection established successfully
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection closed successfully
2024-11-05 04:11:56 - reconciliation_ledger.services.invoice_reconciliation_service - INFO - Starting invoice analysis for payment reference: WIRE847362920183
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Establishing database connection to: reconciliation_ledger/db/reconciliation_ledger.duckdb
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection established successfully
2024-11-05 04:11:56 - reconciliation_ledger.db.invoice_loader - DEBUG - Database connection closed successfully
2024-11-05 04:11:56 - reconcile_actions - INFO - Returning response: ActionResponse(status=success, message='Payment storage and reconciliation analysis completed successfully')
2024-11-05 04:12:51 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
2024-11-05 04:12:51 - reconcile_actions - INFO - Updating work item status for ID: 28b645bd117f3236f3aa8e882847b634
2024-11-05 04:12:52 - root - INFO - Documents Data Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/documents
2024-11-05 04:12:52 - root - INFO - Work Items Client URL set to: https://ace-2ba8afa95fcb42abb1c3e1c2f36fef6e.ext.ci.sema4ai.dev/tenants/d5508320-a7fe-4987-bd26-d066b75558d2/events
2024-11-05 04:12:53 - root - DEBUG - Received data for document_id 28b645bd117f3236f3aa8e882847b634: source_document=SourceDocument(document_id='28b645bd117f3236f3aa8e882847b634', document_name='ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_src_path='s3://ace-2ba8afa9-5fcb-42ab-b1c3-e1c2f36fef6e-di-data/in/d5508320-a7fe-4987-bd26-d066b75558d2/Payment Remittance Reconciliation for Customer Transactions V6/Wire Transfer/ZonalGreen Systems - Wire Transfer - SFD2.pdf', document_type=DocType(name='Payment Remittance Reconciliation for Customer Transactions V6', file_format='PDF', source_location='', description='', validation_expressions=[], non_tbl_fields=[DocumentTypeConfigurationNonTblFieldsInner(name='Customer Name', requirement='Required', id='temp-1730628635138'), DocumentTypeConfigurationNonTblFieldsInner(name='Customer ID', requirement='Required', id='temp-1730628644206'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Date', requirement='Required', id='temp-1730628648089'), DocumentTypeConfigurationNonTblFieldsInner(name='Bank Account Number', requirement='Required', id='temp-1730628653440'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Payment Paid', requirement='Required', id='temp-1730628658440'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Reference Number', requirement='Required', id='temp-1730628663272'), DocumentTypeConfigurationNonTblFieldsInner(name='Payment Method', requirement='Required', id='temp-1730628668074'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoice Amount', requirement='Required', id='temp-1730628673974'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Additional Charges', requirement='Optional', id='temp-1730628685222'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Discounts Applied', requirement='Optional', id='temp-1730628687623'), DocumentTypeConfigurationNonTblFieldsInner(name='Total Invoices', requirement='Required', id='temp-1730628692605'), DocumentTypeConfigurationNonTblFieldsInner(name='Remittance Notes', requirement='Optional', id='temp-1730628699725')], tbl_fields=[DocTypeTblFieldsInner(name='Invoice Details', description='This table contains detailed line-item information for invoices associated with customer payments. It includes critical fields such as invoice number, date, amount due, and payment sent. This table supports AquaEnergy Solutions by capturing utility data such as electricity and water usage.', id='temp-1730628775141', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628812191', column='Invoice Number', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628817739', column='Invoice Date', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628824305', column='Invoice Amount', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628826056', column='Additional Charges', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628830090', column='Discounts Applied', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628834323', column='Amount Paid', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628840606', column='Facility ID', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628917574', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628923123', column='Service Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628927639', column='Usage', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628934757', column='Rate Type', type='', requirement='Optional'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730628936305', column='CO2 Supplementation', type='', requirement='Optional')]), DocTypeTblFieldsInner(name='Facility Type Subtotals', description='Provides a summary of invoice amounts grouped by facility type.', id='temp-1730629018789', table_definition=[DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629029105', column='Facility Type', type='', requirement='Required'), DocumentTypeConfigurationTblFieldsInnerTableDefinitionInner(id='temp-1730629035373', column='Subtotal Invoice Amount', type='', requirement='Required')])], config=['camelot_flavor'], created_timestamp=datetime.datetime(2024, 11, 3, 10, 10, 31, tzinfo=TzInfo(UTC)), updated_timestamp=datetime.datetime(2024, 11, 3, 10, 23, 2, tzinfo=TzInfo(UTC)), processing_workflow=[DocumentProcessingWorkflow(id='885a014d-df4f-4432-8400-f5d6d0549c2e', name='WorkItem', index='1', description='Document Intelligence: Main Processing Stage')]), document_format=DocumentFormat(document_type_name='Payment Remittance Reconciliation for Customer Transactions V6', document_class_name='Wire Transfer', non_tbl_fields_mapping=[DocumentFormatNonTblFieldsMappingInner(field_name='Customer Name', field_identifier='Payer Name', static_value='', id='801980a5-0d34-4d5a-84cb-08e90ee078e3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Customer ID', field_identifier='Client ID', static_value='', id='32f0fa36-cd60-4e06-8ffc-85cd856e20b7', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Date', field_identifier='Wire Transfer Date', static_value='', id='796df829-55b2-45e3-9a14-81e37f9d7cae', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Bank Account Number', field_identifier='Beneficiary Account Number', static_value='', id='7178b499-ce98-41d5-a85a-4e65d0c64f51', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Payment Paid', field_identifier='Total Wire Amount', static_value='', id='a412419d-15a6-41aa-853e-858fae65ff13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Reference Number', field_identifier='Wire Transfer Reference', static_value='', id='d506aa75-ebd4-4510-9c65-d3533f04a418', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Payment Method', field_identifier='Payment Type', static_value='', id='384b0a16-de0b-48e8-83e3-8b401b9657f5', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoice Amount', field_identifier='Total Amount Due', static_value='', id='1cebbd10-10f0-479b-b083-d64b421df84d', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Additional Charges', field_identifier='Total Fees', static_value='', id='d457bb56-1225-488f-842e-50b925e557a3', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Discounts Applied', field_identifier='Total Discounts', static_value='', id='ece4bf02-d39b-4262-b7d5-c93974d3fc13', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Total Invoices', field_identifier='Total Invoices', static_value='', id='21ba1951-9598-4a74-a24b-be2f41a96849', additional_prompt_instructions=''), DocumentFormatNonTblFieldsMappingInner(field_name='Remittance Notes', field_identifier='Additional Payment Notes', static_value='', id='5240008f-adb2-4f40-a144-9505fed93193', additional_prompt_instructions='')], tables=[DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Number', output='Invoice Reference', id='cc38acdf-1d17-4c57-aa41-c049286efbff'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Date', output='Date of Invoice', id='8f6a251e-0700-443e-8e20-6ddcfaa6df50'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Invoice Amount', output='Amount Due', id='cff5c50b-a045-44be-bfb8-9670eedd8ed1'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Additional Charges', output='Fees', id='71688ea6-5c14-4e66-b45c-ebdb849eb569'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Discounts Applied', output='Discounts', id='3d5cd913-6645-4896-ae0f-c495d4f8271c'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Amount Paid', output='Payment Sent', id='27c8f9ad-203c-4e55-9d69-cf2d5419d491'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility ID', output='Facility ID', id='a36554f8-8bfc-41c6-b849-6af06ac45cf8'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='ad68bd93-65a5-4d5e-ae45-da1dd2e12a59'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Service Type', output='Service Type', id='b7de4abc-07cc-4723-91f2-e647c742b6fa'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Usage', output='Usage (kWh/Gallons)', id='3e14afdf-265d-4755-b75b-6f8417188240'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Rate Type', output='', id='4b1bb0c1-4d5e-4575-8378-2feabf22c972'), DocumentFormatTablesInnerTblFieldsMappingInner(source='CO2 Supplementation', output='CO2 Supplementation (kg)', id='d48fb263-a30c-4e74-84f4-049011216422')]), DocumentFormatTablesInner(tbl_fields_mapping=[DocumentFormatTablesInnerTblFieldsMappingInner(source='Facility Type', output='', id='35553893-d3f3-4aad-8e01-3b8901795ce2'), DocumentFormatTablesInnerTblFieldsMappingInner(source='Subtotal Invoice Amount', output='', id='f40587e8-9675-44ec-9fa3-f9265f4d260c')])], prompt_examples='Here are table row examples for Table 1 (Invoice Details), handling different Facility ID labels and includes the derived Facility Type column.\n```markdown\n    \n<!--SOT-->\n| Invoice Reference | Amount Due | Payment Sent | Discounts | Fees | Date of Invoice | Facility ID | Facility Type          | Service Type | Usage (kWh/Gallons) | CO2 Supplementation (kg) |\n|-------------------|------------|--------------|-----------|------|-----------------|-------------|------------------------|--------------|---------------------|-------------------------|\n| INV-GH-005001     | $87,654.22 | $86,777.78   | $876.54   | $0.00| 09/01/2024      | EGA-GH-001  | Greenhouse Complexes   | Electricity  | 730,453 kWh         | 3,652                   |\n| INV-GH-005002     | $45,678.90 | $45,222.11   | $456.79   | $0.00| 09/03/2024      | EGA-GH-001  | Greenhouse Complexes   | Water        | 380,658 Gallons     | N/A                     |\n| INV-GH-005003     | $92,345.67 | $91,422.21   | $923.46   | $0.00| 09/05/2024      | EGA-GH-002  | Greenhouse Complexes   | Electricity  | 769,547 kWh         | 3,848                   |\n| INV-GH-005004     | $56,789.01 | $56,221.12   | $567.89   | $0.00| 09/07/2024      | EGA-GH-002  | Greenhouse Complexes   | Water        | 473,242 Gallons     | N/A                     |\n| INV-GH-005005     | $78,901.23 | $78,112.22   | $789.01   | $0.00| 09/09/2024      | EGA-GH-003  | Greenhouse Complexes   | Electricity  | 657,510 kWh         | 3,288                   |\n| INV-GH-005006     | $34,567.89 | $34,222.21   | $345.68   | $0.00| 09/11/2024      | EGA-GH-003  | Greenhouse Complexes   | Water        | 288,066 Gallons     | N/A                     |\n| INV-GH-005007     | $95,678.90 | $94,722.11   | $956.79   | $0.00| 09/13/2024      | EGA-GH-004  | Greenhouse Complexes   | Electricity  | 797,324 kWh         | 3,987                   |\n| INV-GH-005008     | $67,890.12 | $67,211.22   | $678.90   | $0.00| 09/15/2024      | EGA-GH-004  | Greenhouse Complexes   | Water        | 565,751 Gallons     | N/A                     |\n| INV-GH-005009     | $82,345.67 | $81,522.21   | $823.46   | $0.00| 09/17/2024      | EGA-GH-005  | Greenhouse Complexes   | Electricity  | 686,214 kWh         | 3,431                   |\n| INV-GH-005010     | $43,210.98 | $42,778.87   | $432.11   | $0.00| 09/19/2024      | EGA-GH-005  | Greenhouse Complexes   | Water        | 360,091 Gallons     | N/A                     |\n| INV-GH-005011     | $89,012.34 | $88,122.22   | $890.12   | $0.00| 09/21/2024      | EGA-GH-006  | Greenhouse Complexes   | Electricity  | 741,769 kWh         | 3,709                   |\n| INV-GH-005012     | $54,321.09 | $53,777.78   | $543.21   | $0.00| 09/23/2024      | EGA-GH-006  | Greenhouse Complexes   | Water        | 452,676 Gallons     | N/A                     |\n<!--EOT-->\n```\n\nHere are table row examples for Table 2 (Facility Type Subtotals). It is a derived table for each Facility Type subtotal . Each of these tables should have exactly 1 row. \n```markdown\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------------|-------------------------|\n| Greenhouse Complexes        | $820,112.06             |\n<!--EOT-->\n\n<!--SOT-->\n| Facility Type               | Subtotal Invoice Amount |\n|-----------------------x------|-------------------------|\n| Vertical Farming Units      | $805,831.96             |\n<!--EOT-->\n```', prompt_instructions='Please extract two sets of tables from the document, using the following rules:\n\n### For **Table 1 (Invoice Details):**\n* This table captures detailed invoice-level information for customer payments made to Acqia Energy Solutions. It includes columns:\n  * `Invoice Reference`, `Amount Due`, `Payment Sent`, `Discounts`, `Fees`, `Date of Invoice`, `Facility ID`, `Facility Type`, `Service Type`, `Usage (kWh/Gallons)`, `CO2 Supplementation (kg)`.\n* The column **Facility ID** may be labeled differently across tables. It can appear as **Unit ID**, **System ID**, or simply **Facility**. Treat all these labels as the same column, and extract the relevant ID for each row.\n* **Facility Type** is a derived column that should be added to the extracted table. Populate this column with the Facility Type name based on each section’s subheader (e.g., "Greenhouse Complexes" or "Vertical Farming Units") and ensure every row in the section has the same Facility Type value.\n* Ensure that all other data is extracted based on the columns specified, including `Service Type`, `Usage`, and `CO2 Supplementation`.\n\n### For **Table 2 (Facility Type Subtotals):**\n* This table captures summary information of total invoice amounts grouped by Facility Type. It includes:\n  * `Facility Type`, found in the section header, and `Subtotal Invoice Amount`, found in the bottom line of each table.\n* For example, \'Subtotal for Greenhouse Complexes: $820,112.06\' can be found at the bottom of each table. Extract "Greenhouse Complexes" as the Facility Type and `$820,112.06` as the `Subtotal Invoice Amount`.. ', custom_config={'camelot_flavor': 'lattice'}, state=None), doc_size=39271, pages=4, created_date=datetime.datetime(2024, 11, 5, 3, 55, 10, tzinfo=TzInfo(UTC)), content_type='Wire Transfer') current_content=<ContentState.COMPUTED: 'Computed'> processing_status=<ProcessingStatus.VALIDATION_COMPLETED: 'Validation Completed'> retry_count=3 last_run=datetime.datetime(2024, 11, 5, 5, 9, 31, tzinfo=TzInfo(UTC)) workspace_id='d5508320-a7fe-4987-bd26-d066b75558d2' non_tbl_data={'Customer ID': 'ZGS-928374', 'Payment Date': '2024-11-15', 'Customer Name': 'ZonalGreen Systems', 'Payment Method': 'Wire Transfer', 'Total Invoices': '60', 'Remittance Notes': 'Q4 2024 Utilities for Hydroponic Facilities', 'Total Payment Paid': '$3,715,905.55', 'Bank Account Number': '*****33981', 'Total Invoice Amount': '$3,774,599.76', 'Total Discounts Applied': '$37,534.41', 'Payment Reference Number': 'WIRE847362920183', 'Total Additional Charges': '$0.00'}
2024-11-05 04:12:53 - ReconciliationAgentContextManager - INFO - Starting database initialization
2024-11-05 04:12:53 - ReconciliationAgentContextManager - INFO - Reconciliation tables created successfully
2024-11-05 04:12:53 - ReconciliationAgentContextManager - INFO - Database initialization completed successfully
2024-11-05 04:12:53 - ReconciliationAgentContextManager - DEBUG - Database connection closed successfully.
2024-11-05 04:12:53 - ReconciliationAgentContextManager - INFO - Loading existing reconciliation context for document_id: 28b645bd117f3236f3aa8e882847b634
2024-11-05 04:12:53 - ReconciliationAgentContextManager - DEBUG - Database connection closed successfully.
2024-11-05 04:12:53 - root - ERROR - An unexpected error occurred: (500)
Reason: Internal Server Error
HTTP response headers: HTTPHeaderDict({'Date': 'Tue, 05 Nov 2024 10:12:53 GMT', 'Content-Type': 'application/json', 'Content-Length': '68', 'Connection': 'keep-alive', 'Access-Control-Allow-Origin': '*'})
HTTP response body: {"message":"No old trigger mappings found, not proceeding further"}


2024-11-05 04:12:53 - reconcile_actions - ERROR - Status update failed: Failed to update work item status
Traceback (most recent call last):
  File "/Users/georgevetticaden/.sema4ai/sema4ai-studio/gallery/MyActions/payment-remittance-reconcile-action/0.0.4/reconcile_actions.py", line 278, in update_work_item_status
    raise Exception(error_msg)
Exception: Failed to update work item status
2024-11-05 04:12:53 - reconcile_actions - INFO - Returning response: ActionResponse(status=failure, message='Status update failed: Failed to update work item status')
2024-11-05 04:32:30 - reconcile_actions - INFO - Logging configured using config file: logging-reconcile.conf
